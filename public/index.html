<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GCli2API Cloudflare 管理台 by VeroFess</title>
    <style>
      :root {
        color-scheme: dark;
        font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        --bg: #0b0b0d;
        --panel: #0f1014;
        --panel-soft: #0b0c0f;
        --border: #1a1a1d;
        --muted: #a7abb3;
        --text: #f2f2f5;
        --accent: #f2f2f5;
        background: var(--bg);
        color: var(--text);
      }
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        padding: 0 14px 28px;
        background: var(--bg);
      }
      main {
        max-width: 1080px;
        margin: 0 auto;
      }
      header {
        padding: 18px 0 8px;
        display: flex;
        flex-direction: column;
        gap: 4px;
      }
      h1 {
        margin: 0;
        font-weight: 650;
        letter-spacing: 0.1px;
        font-size: 22px;
      }
      .muted {
        color: var(--muted);
        font-size: 13px;
        line-height: 1.5;
      }
      section {
        border: 1px solid var(--border);
        background: var(--panel);
        border-radius: 2px;
        padding: 14px;
        margin-bottom: 10px;
      }
      .warning {
        border: 1px solid #262626;
        background: #0e0e0f;
        color: #f5e6d0;
        border-radius: 2px;
        padding: 12px 14px;
        line-height: 1.45;
      }
      .warning strong {
        display: inline-block;
        margin-bottom: 6px;
      }
      .warning ul {
        margin: 0;
        padding-left: 16px;
      }
      .warning li + li {
        margin-top: 2px;
      }
      .tabs {
        display: flex;
        gap: 8px;
        margin: 12px 0;
      }
      .tab-btn {
        padding: 9px 12px;
        border-radius: 2px;
        border: 1px solid #2a2a2e;
        background: #101117;
        color: var(--text);
        cursor: pointer;
      }
      .tab-btn.active {
        background: #1b1d25;
        border-color: #3b3b42;
      }
      .tab-panel {
        display: none;
      }
      .tab-panel.active {
        display: block;
      }
      label {
        display: flex;
        flex-direction: column;
        gap: 6px;
        font-size: 13px;
        color: var(--muted);
      }
      input,
      textarea {
        width: 100%;
        padding: 8px 10px;
        border-radius: 2px;
        border: 1px solid var(--border);
        background: var(--panel-soft);
        color: var(--text);
        font-size: 14px;
      }
      textarea {
        min-height: 96px;
      }
      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 12px;
        align-items: end;
      }
      button {
        padding: 9px 12px;
        border-radius: 2px;
        border: 1px solid #2a2a2e;
        background: #0f1115;
        color: var(--text);
        cursor: pointer;
        transition: background 0.15s, border-color 0.15s;
      }
      button.primary {
        background: #16181d;
        border-color: #2f2f34;
      }
      button.primary:hover {
        background: #1d1f25;
      }
      button.danger {
        border-color: #3b2a2a;
        background: #1a1111;
      }
      button.danger:hover {
        background: #211717;
      }
      button.secondary:hover {
        background: #16181d;
      }
      .cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
        gap: 10px;
      }
      .card {
        border: 1px solid var(--border);
        background: var(--panel-soft);
        border-radius: 2px;
        padding: 12px;
      }
      .card h3 {
        margin: 0 0 6px;
      }
      .row {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        align-items: center;
      }
      .pill {
        padding: 2px 10px;
        border-radius: 999px;
        border: 1px solid #2a2a2e;
        font-size: 12px;
        color: #e3e3e6;
      }
      .pill.off {
        border-color: #40352e;
        color: #e6d6c9;
      }
      .message {
        padding: 9px 10px;
        border-radius: 2px;
        margin: 8px 0;
        border: 1px solid #262a30;
        background: #121417;
        color: var(--text);
      }
      .error {
        border-color: #3c1f1f;
        background: #1a1111;
        color: #ffb5b5;
      }
      .empty {
        color: var(--muted);
      }
    </style>
  </head>
  <body>
    <main>
      <header>
        <h1>GCli2API Cloudflare 管理台</h1>
        <p class="muted">
          所有接口均需密码。浏览器请先登录 /login，API 支持 Bearer / x-goog-api-key / ?key。
          密码仅保存在服务器端。
        </p>
      </header>

      <div class="warning">
        <strong>安全提示</strong>
        <ul>
          <li>二次开发请不要添加“网页直接 OAuth 登录”功能，可能导致你的 cf 账号和域名被封!!</li>
          <li>严禁移除这些安全警告。</li>
          <li>本项目开源免费，任何收费售卖/代搭建都是骗局, 同时违反了该项目的授权。</li>
          <li>在此上传 JSON 凭据等同于上传密码，请仅在可信环境操作。</li>
          <li>本子目录使用 PolyForm Noncommercial 许可证（见 LICENSE），禁止任何商用。</li>
        </ul>
      </div>

      <div class="tabs">
        <button class="tab-btn active" data-target="tab-main">Gemini 账户</button>
        <button class="tab-btn" data-target="tab-ant">Antigravity 账户</button>
      </div>

      <div id="tab-main" class="tab-panel active">
        <section>
          <h2 style="margin: 0 0 8px">创建账户</h2>
          <p class="muted" style="margin: 0 0 12px">
            粘贴 authorized_user.json 或填写必要字段。Project ID 可留空但建议填写。
          </p>
          <form id="createForm" class="grid">
            <label>
              账户标签
              <input name="label" placeholder="例如: prod-primary" required />
            </label>
            <label>
              项目 ID
              <input name="projectId" placeholder="例如: my-gcp-project" />
            </label>
            <label>
              Client ID
              <input name="clientId" placeholder="xxxx.apps.googleusercontent.com" />
            </label>
            <label>
              Client Secret
              <input name="clientSecret" placeholder="client secret" />
            </label>
            <label>
              Refresh Token
              <input name="refreshToken" placeholder="refresh token" />
            </label>
            <label>
              Token URI（可选）
              <input name="tokenUri" placeholder="https://oauth2.googleapis.com/token" />
            </label>
            <label style="grid-column: 1/-1">
              authorized_user.json（可选，会覆盖上方字段）
              <textarea
                name="authorizedJson"
                placeholder='{"client_id":"","client_secret":"","refresh_token":"","project_id":""}'
              ></textarea>
            </label>
            <button type="button" class="secondary" id="parseJsonBtn">解析 JSON 并填充</button>
            <button type="submit" class="primary">创建账户</button>
          </form>
          <div id="createMessage" class="message" hidden></div>
        </section>

        <section>
          <h2 style="margin: 0 0 8px">批量导入</h2>
          <p class="muted" style="margin: 0 0 12px">
            支持上传上方格式的批量 JSON（含 creds 字段）。将为每条凭据自动生成标签：优先使用 project_id，其次文件名（去后缀）。
          </p>
          <div class="grid">
            <label style="grid-column: 1/-1">
              批量 JSON
              <textarea id="bulkJson" placeholder='{"creds":{...}}'></textarea>
            </label>
            <label>
              从文件载入
              <input type="file" id="bulkFile" accept=".json,application/json" />
            </label>
            <button type="button" class="primary" id="bulkImportBtn">开始导入</button>
          </div>
          <div id="bulkMessage" class="message" hidden></div>
        </section>

        <section>
          <div class="row" style="justify-content: space-between">
            <h2 style="margin: 0">账户列表</h2>
            <div class="row">
              <button id="reloadBtn" type="button" class="secondary">刷新</button>
            </div>
          </div>
          <div id="accounts" class="cards"></div>
          <div id="empty" class="empty">暂无账户。</div>
          <div id="errorBox" class="message error" hidden></div>
        </section>
      </div>

      <div id="tab-ant" class="tab-panel">
        <section>
          <h2 style="margin: 0 0 8px">导入 Antigravity 账户</h2>
          <p class="muted" style="margin: 0 0 12px">
            粘贴 Antigravity 客户端导出的 JSON（支持顶层对象或 creds 字段），可批量导入。
          </p>
          <div class="grid">
            <label style="grid-column: 1/-1">
              Antigravity JSON
              <textarea
                id="antImportJson"
                placeholder='"userID_xxx": {"status": {...},"content":{"access_token":"", "refresh_token":""}}'
              ></textarea>
            </label>
            <button type="button" class="primary" id="antImportBtn">导入到池</button>
          </div>
          <div id="antImportMessage" class="message" hidden></div>
        </section>

        <section>
          <div class="row" style="justify-content: space-between">
            <h2 style="margin: 0">Antigravity 账户列表</h2>
            <div class="row">
              <button id="antReloadBtn" type="button" class="secondary">刷新</button>
            </div>
          </div>
          <div id="antAccounts" class="cards"></div>
          <div id="antEmpty" class="empty">暂无 Antigravity 账户。</div>
          <div id="antErrorBox" class="message error" hidden></div>
        </section>
      </div>
    </main>

    <script type="module">
      const accountsEl = document.getElementById('accounts');
      const emptyEl = document.getElementById('empty');
      const errorBox = document.getElementById('errorBox');
      const createForm = document.getElementById('createForm');
      const createMessage = document.getElementById('createMessage');
      const parseJsonBtn = document.getElementById('parseJsonBtn');
      const bulkJson = document.getElementById('bulkJson');
      const bulkFile = document.getElementById('bulkFile');
      const bulkImportBtn = document.getElementById('bulkImportBtn');
      const bulkMessage = document.getElementById('bulkMessage');
      const antAccountsEl = document.getElementById('antAccounts');
      const antEmptyEl = document.getElementById('antEmpty');
      const antErrorBox = document.getElementById('antErrorBox');
      const antImportJson = document.getElementById('antImportJson');
      const antImportBtn = document.getElementById('antImportBtn');
      const antImportMessage = document.getElementById('antImportMessage');
      const antReloadBtn = document.getElementById('antReloadBtn');
      const tabButtons = document.querySelectorAll('.tab-btn');
      const tabPanels = document.querySelectorAll('.tab-panel');
      let antLoaded = false;

      function goLogin() {
        window.location.replace('/login');
      }

      tabButtons.forEach((btn) => {
        btn.addEventListener('click', () => {
          tabButtons.forEach((b) => b.classList.remove('active'));
          tabPanels.forEach((panel) => panel.classList.remove('active'));
          btn.classList.add('active');
          const target = document.getElementById(btn.dataset.target);
          target?.classList.add('active');
          if (btn.dataset.target === 'tab-ant' && !antLoaded) {
            loadAntAccounts();
          }
        });
      });

      async function api(path, options = {}) {
        const headers = Object.assign({ 'Content-Type': 'application/json' }, options.headers || {});
        const response = await fetch(path, {
          ...options,
          headers,
          credentials: 'include',
        });
        if (response.redirected) {
          try {
            const redirectUrl = new URL(response.url);
            if (redirectUrl.pathname === '/login') {
              goLogin();
              throw new Error('需要登录');
            }
          } catch {
            /* ignore parse errors */
          }
        }
        if (response.status === 401 || response.status === 403) {
          goLogin();
          throw new Error('需要登录');
        }
        const contentType = response.headers.get('content-type') || '';
        const textBody = await response.text();
        if (!response.ok) {
          let message = textBody || `HTTP ${response.status}`;
          if (textBody && contentType.includes('application/json')) {
            try {
              const data = JSON.parse(textBody);
              if (data?.error?.message) message = data.error.message;
              else if (data?.message) message = data.message;
            } catch {
              /* ignore */
            }
          }
          throw new Error(message);
        }
        if (response.status === 204) return null;
        if (!textBody) return null;
        if (contentType.includes('application/json')) {
          try {
            return JSON.parse(textBody);
          } catch {
            // fall through
          }
        }
        return textBody;
      }

      function renderAccounts(list) {
        accountsEl.innerHTML = '';
        if (!list.length) {
          emptyEl.hidden = false;
          return;
        }
        emptyEl.hidden = true;
        for (const acc of list) {
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <div class="row" style="justify-content: space-between">
              <div>
                <h3 style="margin:0">${escapeHtml(acc.label)}</h3>
                <div class="muted">项目: ${escapeHtml(acc.projectId || '未设置')}</div>
              </div>
              <div class="pill ${acc.isEnabled ? '' : 'off'}">
                ${acc.isEnabled ? '启用中' : '已停用'}
              </div>
            </div>
            <div class="muted">更新时间: ${formatDate(acc.updatedAt)}</div>
            ${acc.lastError ? `<div class="message error">最近错误: ${escapeHtml(acc.lastError)}</div>` : ''}
            <div class="row" style="margin-top:10px">
              <button data-action="toggle" data-id="${acc.id}">
                ${acc.isEnabled ? '停用' : '启用'}
              </button>
              <button data-action="project" data-id="${acc.id}">更新项目 ID</button>
              <button data-action="import" data-id="${acc.id}" data-label="${acc.label}">导入 JSON</button>
              <button data-action="export" data-id="${acc.id}" data-label="${acc.label}">导出 JSON</button>
              <button data-action="delete" data-id="${acc.id}" class="danger">删除</button>
            </div>
          `;
          accountsEl.appendChild(card);
        }
      }

      function renderAntAccounts(list) {
        antAccountsEl.innerHTML = '';
        if (!list.length) {
          antEmptyEl.hidden = false;
          return;
        }
        antEmptyEl.hidden = true;
        for (const acc of list) {
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <div class="row" style="justify-content: space-between">
              <div>
                <h3 style="margin:0">${escapeHtml(acc.label)}</h3>
                <div class="muted">用户: ${escapeHtml(acc.userId || '未设置')}</div>
                <div class="muted">邮箱: ${escapeHtml(acc.userEmail || '未设置')}</div>
              </div>
              <div class="pill ${acc.isEnabled ? '' : 'off'}">
                ${acc.isEnabled ? '启用中' : '已停用'}
              </div>
            </div>
            <div class="muted">更新时间: ${formatDate(acc.updatedAt)}</div>
            ${acc.lastError ? `<div class="message error">最近错误: ${escapeHtml(acc.lastError)}</div>` : ''}
            <div class="row" style="margin-top:10px">
              <button data-action="ant-toggle" data-id="${acc.id}">
                ${acc.isEnabled ? '停用' : '启用'}
              </button>
              <button data-action="ant-export" data-id="${acc.id}" data-label="${acc.label}">导出 JSON</button>
              <button data-action="ant-delete" data-id="${acc.id}" class="danger">删除</button>
            </div>
          `;
          antAccountsEl.appendChild(card);
        }
      }

      async function loadAccounts() {
        errorBox.hidden = true;
        try {
          const data = await api('/api/accounts');
          renderAccounts(data.accounts || []);
        } catch (error) {
          errorBox.hidden = false;
          errorBox.textContent = error.message;
        }
      }

      async function loadAntAccounts() {
        antErrorBox.hidden = true;
        try {
          const data = await api('/api/ant/accounts');
          renderAntAccounts(data.accounts || []);
          antLoaded = true;
        } catch (error) {
          antErrorBox.hidden = false;
          antErrorBox.textContent = error.message;
        }
      }

      createForm.addEventListener('submit', async (event) => {
        event.preventDefault();
        createMessage.hidden = true;
        const form = new FormData(createForm);
        const body = {
          label: form.get('label')?.trim(),
          projectId: form.get('projectId')?.trim(),
          clientId: form.get('clientId')?.trim() || undefined,
          clientSecret: form.get('clientSecret')?.trim() || undefined,
          refreshToken: form.get('refreshToken')?.trim() || undefined,
          tokenUri: form.get('tokenUri')?.trim() || undefined,
        };
        const jsonText = form.get('authorizedJson')?.trim();
        if (jsonText) {
          try {
            body.authorizedUser = JSON.parse(jsonText);
          } catch (error) {
            createMessage.hidden = false;
            createMessage.className = 'message error';
            createMessage.textContent = 'authorized_user 区块不是合法 JSON';
            return;
          }
        }
        try {
          await api('/api/accounts', {
            method: 'POST',
            body: JSON.stringify(body),
          });
          createForm.reset();
          createMessage.hidden = false;
          createMessage.className = 'message';
          createMessage.textContent = '账户已创建，首次请求会自动刷新 Access Token。';
          await loadAccounts();
        } catch (error) {
          createMessage.hidden = false;
          createMessage.className = 'message error';
          createMessage.textContent = error.message;
        }
      });

      accountsEl.addEventListener('click', async (event) => {
        const target = event.target;
        if (!(target instanceof HTMLElement)) return;
        const action = target.dataset.action;
        const id = target.dataset.id;
        if (!action || !id) return;
        try {
          if (action === 'delete') {
            const ok = confirm('确定删除该账户吗？此操作不可恢复。');
            if (!ok) return;
            await api(`/api/accounts/${id}`, { method: 'DELETE' });
          } else if (action === 'toggle') {
            const enable = target.textContent?.includes('启用');
            await api(`/api/accounts/${id}/enabled`, {
              method: 'PATCH',
              body: JSON.stringify({ enabled: enable }),
            });
          } else if (action === 'project') {
            const newProject = prompt('输入新的 Project ID');
            if (!newProject) return;
            await api(`/api/accounts/${id}/project`, {
              method: 'PATCH',
              body: JSON.stringify({ projectId: newProject.trim() }),
            });
          } else if (action === 'import') {
            const file = await pickJsonFile();
            if (!file) return;
            const text = await file.text();
            let payload;
            try {
              payload = JSON.parse(text);
            } catch {
              alert('JSON 文件不合法');
              return;
            }
            await api(`/api/accounts/${id}/credentials/import`, {
              method: 'POST',
              body: JSON.stringify({ authorizedUser: payload }),
            });
          } else if (action === 'export') {
            const label = target.dataset.label || id;
            const data = await api(`/api/accounts/${id}/credentials/export`);
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${sanitizeFileName(label)}-authorized_user.json`;
            document.body.appendChild(a);
            a.click();
            a.remove();
            URL.revokeObjectURL(url);
          }
          await loadAccounts();
        } catch (error) {
          alert(error.message);
        }
      });

      antAccountsEl.addEventListener('click', async (event) => {
        const target = event.target;
        if (!(target instanceof HTMLElement)) return;
        const action = target.dataset.action;
        const id = target.dataset.id;
        if (!action || !id) return;
        try {
          if (action === 'ant-delete') {
            const ok = confirm('确定删除该账户吗？此操作不可恢复。');
            if (!ok) return;
            await api(`/api/ant/accounts/${id}`, { method: 'DELETE' });
          } else if (action === 'ant-toggle') {
            const enable = target.textContent?.includes('启用');
            await api(`/api/ant/accounts/${id}/enabled`, {
              method: 'PATCH',
              body: JSON.stringify({ enabled: enable }),
            });
          } else if (action === 'ant-export') {
            const label = target.dataset.label || id;
            const data = await api(`/api/ant/accounts/${id}/export`);
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${sanitizeFileName(label)}-antigravity.json`;
            document.body.appendChild(a);
            a.click();
            a.remove();
            URL.revokeObjectURL(url);
          }
          await loadAntAccounts();
        } catch (error) {
          alert(error.message);
        }
      });

      parseJsonBtn?.addEventListener('click', () => {
        tryFillFromJson();
      });

      bulkFile?.addEventListener('change', async () => {
        if (!bulkFile.files || !bulkFile.files[0]) return;
        const file = bulkFile.files[0];
        try {
          const text = await file.text();
          bulkJson.value = text;
          showBulkHint(`已载入文件：${file.name}`, false);
        } catch {
          showBulkHint('读取文件失败', true);
        }
      });

      bulkImportBtn?.addEventListener('click', async () => {
        const text = bulkJson.value.trim();
        if (!text) {
          showBulkHint('请先填写或上传批量 JSON', true);
          return;
        }
        let payload;
        try {
          payload = JSON.parse(text);
        } catch {
          showBulkHint('批量 JSON 解析失败', true);
          return;
        }
        showBulkHint('正在导入...', false);
        try {
          const res = await api('/api/accounts/bulk', {
            method: 'POST',
            body: JSON.stringify(payload),
          });
          const summary = `共 ${res.total || 0} 条，新增 ${res.created || 0}，跳过 ${res.skipped || 0}，失败 ${
            res.failed || 0
          }。`;
          showBulkHint(summary, res.failed > 0);
          if (Array.isArray(res.results)) {
            const detail = res.results
              .slice(0, 5)
              .map((r) => `${r.label || '未知'}: ${r.status}${r.message ? ` (${r.message})` : ''}`)
              .join(' / ');
            if (detail) {
              bulkMessage.textContent += ` ${detail}`;
            }
          }
          await loadAccounts();
        } catch (error) {
          showBulkHint(error.message, true);
        }
      });

      antImportBtn?.addEventListener('click', async () => {
        const text = antImportJson.value.trim();
        if (!text) {
          showAntHint('请先粘贴 Antigravity JSON', true);
          return;
        }
        let payload;
        try {
          payload = JSON.parse(text);
        } catch {
          showAntHint('JSON 解析失败', true);
          return;
        }
        showAntHint('正在导入...', false);
        try {
          const res = await api('/api/ant/accounts/import', {
            method: 'POST',
            body: JSON.stringify(payload),
          });
          const summary = `共 ${res.total || 0} 条，新增 ${res.created || 0}，跳过 ${res.skipped || 0}，失败 ${res.failed || 0}。`;
          showAntHint(summary, res.failed > 0);
          await loadAntAccounts();
        } catch (error) {
          showAntHint(error.message, true);
        }
      });

      function tryFillFromJson() {
        const textarea = createForm.querySelector('textarea[name="authorizedJson"]');
        if (!textarea) return;
        const text = textarea.value.trim();
        if (!text) {
          showCreateHint('请先粘贴 authorized_user.json', true);
          return;
        }
        let payload;
        try {
          payload = JSON.parse(text);
        } catch {
          showCreateHint('JSON 解析失败，请检查格式', true);
          return;
        }
        if (typeof payload !== 'object' || Array.isArray(payload)) {
          showCreateHint('JSON 必须是对象', true);
          return;
        }
        const setIf = (name, value) => {
          const input = createForm.querySelector(`[name="${name}"]`);
          if (!input || typeof value !== 'string' || !value.trim()) return;
          input.value = value.trim();
        };
        setIf('clientId', payload.client_id || payload.clientId);
        setIf('clientSecret', payload.client_secret || payload.clientSecret);
        setIf('refreshToken', payload.refresh_token || payload.refreshToken);
        setIf('tokenUri', payload.token_uri || payload.tokenUri);
        setIf('projectId', payload.project_id || payload.projectId);
        showCreateHint('已从 JSON 填充字段，可直接提交。', false);
      }

      function showCreateHint(text, isError) {
        createMessage.hidden = false;
        createMessage.className = 'message' + (isError ? ' error' : '');
        createMessage.textContent = text;
      }

      function showBulkHint(text, isError) {
        bulkMessage.hidden = false;
        bulkMessage.className = 'message' + (isError ? ' error' : '');
        bulkMessage.textContent = text;
      }

      function showAntHint(text, isError) {
        antImportMessage.hidden = false;
        antImportMessage.className = 'message' + (isError ? ' error' : '');
        antImportMessage.textContent = text;
      }

      document.getElementById('reloadBtn')?.addEventListener('click', loadAccounts);
      antReloadBtn?.addEventListener('click', loadAntAccounts);
      loadAccounts();
      loadAntAccounts();

      function pickJsonFile() {
        return new Promise((resolve) => {
          const input = document.createElement('input');
          input.type = 'file';
          input.accept = '.json,application/json';
          input.addEventListener(
            'change',
            () => {
              resolve(input.files && input.files[0] ? input.files[0] : null);
            },
            { once: true },
          );
          input.click();
        });
      }

      function sanitizeFileName(name) {
        return String(name || 'account').replace(/[^\w.-]+/g, '_');
      }

      function formatDate(value) {
        const date = new Date(value);
        if (Number.isNaN(date.getTime())) return '未知时间';
        return date.toLocaleString();
      }

      function escapeHtml(value) {
        return String(value)
          .replace(/&/g, '&amp;')
          .replace(/</g, '&lt;')
          .replace(/>/g, '&gt;')
          .replace(/"/g, '&quot;')
          .replace(/'/g, '&#39;');
      }
    </script>
  </body>
</html>
